# 快速开始

<cite>
**本文档中引用的文件**
- [README.md](file://README.md)
- [pom.xml](file://pom.xml)
- [ExcelHelper.java](file://src/main/java/com/github/stupdit1t/excel/core/ExcelHelper.java)
- [OpsExport.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsExport.java)
- [OpsSheet.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsSheet.java)
- [OpsHeader.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsHeader.java)
- [Student.java](file://src/test/java/excel/export/data/Student.java)
- [ClassRoom.java](file://src/test/java/excel/export/data/ClassRoom.java)
</cite>

## 目录
1. [简介](#简介)
2. [先决条件](#先决条件)
3. [Maven依赖配置](#maven依赖配置)
4. [完整示例代码](#完整示例代码)
5. [代码详解](#代码详解)
6. [验证集成](#验证集成)
7. [常见问题](#常见问题)

## 简介

poi-excel 是一个基于 Apache POI 的 Java 工具库，专为简化 Excel 表格处理而设计。它提供了简单易用的 API，让开发者能够在几分钟内完成 Excel 导出功能的集成。

## 先决条件

在开始使用 poi-excel 之前，请确保您的开发环境满足以下要求：

- **JDK 版本**: JDK 1.8 或更高版本
- **构建工具**: Maven 或 Gradle
- **Servlet API**: 支持 Servlet 3.0+（用于 Web 应用）

## Maven依赖配置

将以下 Maven 依赖添加到您的 `pom.xml` 文件中：

```xml
<dependency>
    <groupId>com.github.stupdit1t</groupId>
    <artifactId>poi-excel</artifactId>
    <version>3.3.0</version>
</dependency>
```

这个依赖包含了：
- Apache POI 5.2.3 核心库
- Apache POI OOXML 扩展
- Commons Lang 3.12.0 工具库
- Servlet API 4.0.1 支持

**章节来源**
- [pom.xml](file://pom.xml#L1-L136)

## 完整示例代码

以下是一个完整的 Spring Web 环境下的 Excel 导出示例：

```java
@RestController
@RequestMapping("/api/excel")
public class ExcelController {

    @GetMapping("/export")
    public void export(HttpServletResponse response, SysErrorLogQueryParam queryParams) {
        // 1.获取列表数据
        List<SysErrorLog> data = sysErrorLogService.queryList(queryParams);
        
        // 2.执行导出
        ExcelHelper.opsExport(PoiWorkbookType.XLSX)
                .opsSheet(data)
                .opsHeader().simple()
                    .texts("请求地址", "请求方式", "IP地址", "简要信息", "异常时间", "创建人").done()
                .opsColumn()
                    .fields("requestUri","requestMethod","ip","errorSimpleInfo","createDate","creatorName").done()
                .export(response, "异常日志.xlsx");
    }
}
```

**章节来源**
- [README.md](file://README.md#L30-L45)

## 代码详解

让我们逐步解析这段代码的每一部分：

### 第一步：获取数据

```java
List<SysErrorLog> data = sysErrorLogService.queryList(queryParams);
```

- **作用**: 从数据库或其他数据源获取需要导出的数据
- **关键点**: 数据应该是 Java Bean 对象的列表，每个对象对应 Excel 中的一行

### 第二步：创建导出器

```java
ExcelHelper.opsExport(PoiWorkbookType.XLSX)
```

- **作用**: 创建 Excel 导出器实例
- **参数**: `PoiWorkbookType.XLSX` 指定输出格式为 `.xlsx` 文件
- **返回值**: 返回 `OpsExport` 实例，支持链式调用

### 第三步：设置工作表

```java
.opsSheet(data)
```

- **作用**: 将数据绑定到工作表
- **参数**: `data` 是包含导出数据的列表
- **返回值**: 返回 `OpsSheet` 实例，用于进一步配置工作表属性

### 第四步：配置表头

```java
.opsHeader().simple()
    .texts("请求地址", "请求方式", "IP地址", "简要信息", "异常时间", "创建人").done()
```

- **作用**: 设置简单表头
- **方法说明**:
  - `simple()`: 选择简单表头模式
  - `texts(...)`: 设置表头文本
  - `done()`: 完成表头配置

### 第五步：配置数据列

```java
.opsColumn()
    .fields("requestUri","requestMethod","ip","errorSimpleInfo","createDate","creatorName").done()
```

- **作用**: 映射数据字段到 Excel 列
- **方法说明**:
  - `fields(...)`: 指定 Java 对象的属性名
  - 属性名必须与 Java Bean 的 getter 方法匹配
  - 导出时会自动调用对应的 getter 方法获取值

### 第六步：执行导出

```java
.export(response, "异常日志.xlsx");
```

- **作用**: 将 Excel 文件直接输出到 HTTP 响应
- **参数**:
  - `response`: HttpServletResponse 对象
  - `"异常日志.xlsx"`: 下载文件名
- **效果**: 用户浏览器会自动下载 Excel 文件

**章节来源**
- [ExcelHelper.java](file://src/main/java/com/github/stupdit1t/excel/core/ExcelHelper.java#L1-L54)
- [OpsExport.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsExport.java#L1-L339)
- [OpsSheet.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsSheet.java#L1-L289)
- [OpsHeader.java](file://src/main/java/com/github/stupdit1t/excel/core/export/OpsHeader.java#L1-L245)

## 验证集成

完成集成后，请按照以下步骤验证：

### 1. 检查依赖是否正确下载

在 Maven 项目中运行：
```bash
mvn dependency:tree | grep poi-excel
```

应该能看到类似输出：
```
+- com.github.stupdit1t:poi-excel:jar:3.3.0:compile
```

### 2. 编译项目

确保项目能够成功编译，没有导入错误。

### 3. 运行测试

创建一个简单的测试控制器，调用导出接口：
```java
@Test
public void testExcelExport() throws Exception {
    MockHttpServletResponse response = new MockHttpServletResponse();
    excelController.export(response, new SysErrorLogQueryParam());
    
    assertTrue(response.getContentLength() > 0);
    assertEquals("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", 
                 response.getContentType());
}
```

### 4. 验证生成的 Excel 文件

- 打开生成的 Excel 文件
- 检查表头是否正确显示
- 验证数据是否正确映射
- 确认文件大小合理

## 常见问题

### Q1: 为什么导出的 Excel 文件为空？

**可能原因**:
- 数据列表为空
- 字段映射错误
- 数据类型不匹配

**解决方案**:
```java
// 添加调试输出
System.out.println("导出数据数量: " + data.size());
System.out.println("第一个对象: " + data.get(0));
```

### Q2: 如何处理复杂的数据结构？

对于嵌套对象，如 `Student` 类中的 `ClassRoom` 属性：

```java
.opsColumn()
    .fields("name", "classRoom.name", "moreInfo['address']", "moreInfo['age']")
    .done()
```

### Q3: 如何设置自定义样式？

```java
.opsHeader().simple()
    .texts("姓名", "班级", "地址").done()
.opsColumn()
    .fields("name", "classRoom.name", "moreInfo['address']").done()
.style(DefaultCellStyleEnum.BOLD_HEADER, DefaultCellStyleEnum.CENTER_CONTENT)
.done()
```

### Q4: 如何处理大文件导出？

```java
ExcelHelper.opsExport(PoiWorkbookType.BIG_XLSX)  // 使用 SXSSF 格式
    .opsSheet(data)
    .opsHeader().simple().texts(...).done()
    .opsColumn().fields(...).done()
    .parallelSheet()  // 并行处理多个工作表
    .export(response, "大文件.xlsx");
```

## 总结

通过以上步骤，您应该能够在 5 分钟内完成 poi-excel 的首次导出。这个工具库的主要优势包括：

- **简单易用**: 链式调用语法，直观易懂
- **功能强大**: 支持复杂表头、样式、图片等多种功能
- **性能优秀**: 内置大文件支持和并行处理
- **零侵入**: 不需要注解，纯代码实现

建议您参考项目的详细文档，了解更多高级功能和最佳实践。